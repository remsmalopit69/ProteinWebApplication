@{
    ViewBag.Title = "Checkout";
    Layout = "~/Views/Shared/_PublicLayout.cshtml";
}

<div ng-init="initCheckout()">

    <!-- Page Header -->
    <section class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-12">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold mb-2">Checkout</h1>
            <p class="text-blue-100">Complete your order</p>
        </div>
    </section>

    <!-- Checkout Section -->
    <section class="py-12 bg-gray-50 min-h-screen">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                <!-- Checkout Form -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Shipping Information</h2>

                        <form ng-submit="processCheckout()" name="checkoutForm" novalidate>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        Full Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text"
                                           name="customerName"
                                           ng-model="checkoutForm.customerName"
                                           class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           ng-class="{'border-red-500': checkoutForm.customerName.$invalid && checkoutForm.customerName.$touched}"
                                           placeholder="Juan Dela Cruz"
                                           required
                                           minlength="2"
                                           maxlength="100"
                                           ng-pattern="/^[a-zA-Z\s]+$/">
                                    <div class="mt-1 text-xs text-red-600" ng-show="checkoutForm.customerName.$touched">
                                        <p ng-show="checkoutForm.customerName.$error.required">Full name is required</p>
                                        <p ng-show="checkoutForm.customerName.$error.minlength">Name must be at least 2 characters</p>
                                        <p ng-show="checkoutForm.customerName.$error.pattern">Name can only contain letters and spaces</p>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">
                                        Email Address <span class="text-red-500">*</span>
                                    </label>
                                    <input type="email"
                                           name="customerEmail"
                                           ng-model="checkoutForm.customerEmail"
                                           class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           ng-class="{'border-red-500': checkoutForm.customerEmail.$invalid && checkoutForm.customerEmail.$touched}"
                                           placeholder="juan@example.com"
                                           required>
                                    <div class="mt-1 text-xs text-red-600" ng-show="checkoutForm.customerEmail.$touched">
                                        <p ng-show="checkoutForm.customerEmail.$error.required">Email is required</p>
                                        <p ng-show="checkoutForm.customerEmail.$error.email">Please enter a valid email address</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 font-medium mb-2">
                                    Phone Number <span class="text-red-500">*</span>
                                </label>
                                <input type="tel"
                                       name="customerPhone"
                                       ng-model="checkoutForm.customerPhone"
                                       class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       ng-class="{'border-red-500': checkoutForm.customerPhone.$invalid && checkoutForm.customerPhone.$touched}"
                                       placeholder="09XX-XXX-XXXX"
                                       required
                                       ng-pattern="/^(09|\+639)\d{9}$/">
                                <div class="mt-1 text-xs text-red-600" ng-show="checkoutForm.customerPhone.$touched">
                                    <p ng-show="checkoutForm.customerPhone.$error.required">Phone number is required</p>
                                    <p ng-show="checkoutForm.customerPhone.$error.pattern">Enter valid PH mobile (09XXXXXXXXX)</p>
                                </div>
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 font-medium mb-2">
                                    Shipping Address <span class="text-red-500">*</span>
                                </label>
                                <textarea name="shippingAddress"
                                          ng-model="checkoutForm.shippingAddress"
                                          class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          ng-class="{'border-red-500': checkoutForm.shippingAddress.$invalid && checkoutForm.shippingAddress.$touched}"
                                          placeholder="Enter your complete shipping address (House/Unit No., Street, Barangay, City, Province)"
                                          rows="3"
                                          required
                                          minlength="20"
                                          maxlength="255"></textarea>
                                <div class="mt-1 text-xs text-red-600" ng-show="checkoutForm.shippingAddress.$touched">
                                    <p ng-show="checkoutForm.shippingAddress.$error.required">Shipping address is required</p>
                                    <p ng-show="checkoutForm.shippingAddress.$error.minlength">Please provide a complete address (at least 20 characters)</p>
                                </div>
                                <p class="mt-1 text-xs text-gray-500">Please include: House/Unit No., Street, Barangay, City, Province, Postal Code</p>
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 font-medium mb-2">Order Notes (Optional)</label>
                                <textarea name="orderNotes"
                                          ng-model="checkoutForm.orderNotes"
                                          class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="Any special instructions for your order (e.g., delivery time preferences, landmarks)"
                                          rows="2"
                                          maxlength="500"></textarea>
                                <p class="mt-1 text-xs text-gray-500">{{checkoutForm.orderNotes.length || 0}}/500 characters</p>
                            </div>

                            <button type="submit"
                                    ng-disabled="checkoutForm.$invalid || cart.length === 0"
                                    class="w-full bg-blue-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                                <i class="fas fa-check-circle mr-2"></i>Place Order
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Order Summary</h2>

                        <!-- Cart Items -->
                        <div class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                            <div ng-repeat="item in cart" class="flex gap-4 pb-4 border-b">
                                <img ng-src="{{item.image || 'https://via.placeholder.com/80'}}"
                                     alt="{{item.productName}}"
                                     class="w-20 h-20 object-cover rounded">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800 text-sm">{{item.productName}}</h4>
                                    <p class="text-gray-600 text-sm">Qty: {{item.quantity}}</p>
                                    <p class="font-bold text-blue-600">₱{{item.price * item.quantity | number:2}}</p>
                                </div>
                            </div>

                            <div ng-if="cart.length === 0" class="text-center py-8 text-gray-400">
                                <i class="fas fa-shopping-cart text-4xl mb-2"></i>
                                <p>Your cart is empty</p>
                            </div>
                        </div>

                        <!-- Totals -->
                        <div class="space-y-3 mb-6 pt-4 border-t">
                            <div class="flex justify-between text-gray-600">
                                <span>Subtotal</span>
                                <span>₱{{getCartSubtotal() | number:2}}</span>
                            </div>
                            <div class="flex justify-between text-gray-600">
                                <span>Shipping</span>
                                <span class="text-green-600 font-semibold">FREE</span>
                            </div>
                            <div class="flex justify-between text-xl font-bold text-gray-800 pt-3 border-t">
                                <span>Total</span>
                                <span class="text-blue-600">₱{{getCartTotal() | number:2}}</span>
                            </div>
                        </div>

                        <!-- Security Note -->
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <div class="flex items-start">
                                <i class="fas fa-shield-check text-green-600 mt-1 mr-3"></i>
                                <div>
                                    <p class="text-sm text-gray-700 font-semibold mb-1">Secure Checkout</p>
                                    <p class="text-xs text-gray-600">Your information is protected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>